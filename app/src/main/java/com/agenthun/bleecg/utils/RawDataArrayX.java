package com.agenthun.bleecg.utils;

/**
 * @project BleECG
 * @authors agenthun
 * @date 16/5/22 02:24.
 */
public class RawDataArrayX {
    private static final int BUFFER_SIZE_HPF = 131;
    private static final int BUFFER_SIZE_LPF = 257;
    public static final int arrayLength = 2048;

    private static float rawMax = 10000f;
    private static float scaleRate = 768 / (2f * rawMax);

    private float[] array = new float[arrayLength];
    private float[] quiteArray = new float[arrayLength];
    private float[] eegBufferHPF = new float[BUFFER_SIZE_HPF];
    private float[] tempeegBufferHPF = new float[BUFFER_SIZE_HPF];
    private float[] eegBufferLPF = new float[BUFFER_SIZE_LPF];
    private float[] tempeegBufferLPF = new float[BUFFER_SIZE_LPF];

/*    private float egoRawData;
    private float baseLine;
    private float bottomBorde;
    private int bufferCounter = 0;
    private static float filtered;
    public static int rawData;
    public static Object syncRoot = new Object();
    private static float topBorde;*/

    private static final double[] FILT_COEFF_HPF = {
            0.0240815539286682D, 0.00094071589759869205D, 0.00095643797019856003D, 0.00096969741145219897D, 0.0009814685575474599D, 0.00099037312341015006D, 0.00099804534329050792D, 0.0010026867073676599D, 0.00100598820112366D, 0.00100617210221234D,
            0.0010050290498218599D, 0.0010006553053761599D, 0.00099484499178925309D, 0.00098556811727289D, 0.00097475911168395804D, 0.00096040614145063497D, 0.00094461721992347301D, 0.00092531628457959798D, 0.00090405637773081199D, 0.00087803107631781604D,
            0.00085236463067489305D, 0.00082073414158823001D, 0.00078737089428539001D, 0.00075016617322136501D, 0.000711117897876378D, 0.00066678464110374704D, 0.00062092884670519096D, 0.000569590780355754D, 0.00051729620911613997D, 0.00045922787778501502D,
            0.000400845175023879D, 0.00033630074179004198D, 0.00027256131528735302D, 0.000202258572689728D, 0.00013451250346698399D, 5.8924994634592503E-05D, -1.20066664151013E-05D, -9.5440400030703205E-05D, -0.00017194468377141199D, -0.00029031045152137498D,
            -0.00037128259964632902D, -0.00045221606004262199D, -0.00056144697952025197D, -0.00065666895269964303D, -0.00076559216113548099D, -0.00086952609872032003D, -0.00098315811553579603D, -0.0010941426335667D, -0.00121295233934373D, -0.0013303446847923099D,
            -0.0014544866664956801D, -0.0015778474281691801D, -0.00170707020704287D, -0.0018358293289846401D, -0.00196982297031473D, -0.00210375948260535D, -0.0022425610057159599D, -0.0023815793642805801D, -0.0025235549400708401D, -0.0026678213256033098D,
            -0.0028152536182213901D, -0.0029615794091826298D, -0.0031131949278439702D, -0.0032647695397825102D, -0.0034195983938850199D, -0.0035741410703006701D, -0.0037316317668547698D, -0.0038889048496793801D, -0.0040486898040555698D, -0.0042080476847704698D,
            -0.0043692897388095302D, -0.0045300093508119097D, -0.0046923233451523902D, -0.0048545972263488698D, -0.0050184816339522102D, -0.0051829659846649601D, -0.0053482587010216399D, -0.0055136723994696803D, -0.0056736504539967999D, -0.0058336045071319198D,
            -0.0060048113420042596D, -0.0061624399260124599D, -0.0063267624410810203D, -0.0064863404019083696D, -0.0066481384622024096D, -0.0068059828216626098D, -0.0069652208558077704D, -0.0071207562971531899D, -0.0072769956159112904D, -0.0074294290266545601D,
            -0.0075819810361198803D, -0.0077306784903475702D, -0.0078790754850292799D, -0.00802359020324072D, -0.0081672347066319498D, -0.0083068947377328596D, -0.0084448953876613605D, -0.0085802329202447607D, -0.0087128291115401903D, -0.0088399154133359508D,
            -0.0089689777949022095D, -0.0090907612137699507D, -0.0092109154371142095D, -0.0093257224296772398D, -0.0094392503107350902D, -0.0095471215816080798D, -0.0096530702301007194D, -0.0097529737718442394D, -0.0098506769079372905D, -0.0099423833252741799D,
            -0.0100319523396413D, -0.0101155472657584D, -0.010196757661607001D, -0.010271499262342901D, -0.010343251179007199D, -0.010408013358444801D, -0.0104698462066671D, -0.0105264232534087D, -0.010582456121673699D, -0.0106254656477531D,
            -0.0106698240075694D, -0.0107071317996993D, -0.0107401875728401D, -0.010767361534073599D, -0.0107908375550297D, -0.010808023245587601D, -0.0108214089326342D, -0.0108283613423595D, 0.98916843384974595D, -0.0108283613423595D,
            -0.0108214089326342D, -0.010808023245587601D, -0.0107908375550297D, -0.010767361534073599D, -0.0107401875728401D, -0.0107071317996993D, -0.0106698240075694D, -0.0106254656477531D, -0.010582456121673699D, -0.0105264232534087D,
            -0.0104698462066671D, -0.010408013358444801D, -0.010343251179007199D, -0.010271499262342901D, -0.010196757661607001D, -0.0101155472657584D, -0.0100319523396413D, -0.0099423833252741799D, -0.0098506769079372905D, -0.0097529737718442394D,
            -0.0096530702301007194D, -0.0095471215816080798D, -0.0094392503107350902D, -0.0093257224296772398D, -0.0092109154371142095D, -0.0090907612137699507D, -0.0089689777949022095D, -0.0088399154133359508D, -0.0087128291115401903D, -0.0085802329202447607D,
            -0.0084448953876613605D, -0.0083068947377328596D, -0.0081672347066319498D, -0.00802359020324072D, -0.0078790754850292799D, -0.0077306784903475702D, -0.0075819810361198803D, -0.0074294290266545601D, -0.0072769956159112904D, -0.0071207562971531899D,
            -0.0069652208558077704D, -0.0068059828216626098D, -0.0066481384622024096D, -0.0064863404019083696D, -0.0063267624410810203D, -0.0061624399260124599D, -0.0060048113420042596D, -0.0058336045071319198D, -0.0056736504539967999D, -0.0055136723994696803D,
            -0.0053482587010216399D, -0.0051829659846649601D, -0.0050184816339522102D, -0.0048545972263488698D, -0.0046923233451523902D, -0.0045300093508119097D, -0.0043692897388095302D, -0.0042080476847704698D, -0.0040486898040555698D, -0.0038889048496793801D,
            -0.0037316317668547698D, -0.0035741410703006701D, -0.0034195983938850199D, -0.0032647695397825102D, -0.0031131949278439702D, -0.0029615794091826298D, -0.0028152536182213901D, -0.0026678213256033098D, -0.0025235549400708401D, -0.0023815793642805801D,
            -0.0022425610057159599D, -0.00210375948260535D, -0.00196982297031473D, -0.0018358293289846401D, -0.00170707020704287D, -0.0015778474281691801D, -0.0014544866664956801D, -0.0013303446847923099D, -0.00121295233934373D, -0.0010941426335667D,
            -0.00098315811553579603D, -0.00086952609872032003D, -0.00076559216113548099D, -0.00065666895269964303D, -0.00056144697952025197D, -0.00045221606004262199D, -0.00037128259964632902D, -0.00029031045152137498D, -0.00017194468377141199D, -9.5440400030703205E-05D,
            -1.20066664151013E-05D, 5.8924994634592503E-05D, 0.00013451250346698399D, 0.000202258572689728D, 0.00027256131528735302D, 0.00033630074179004198D, 0.000400845175023879D, 0.00045922787778501502D, 0.00051729620911613997D, 0.000569590780355754D,
            0.00062092884670519096D, 0.00066678464110374704D, 0.000711117897876378D, 0.00075016617322136501D, 0.00078737089428539001D, 0.00082073414158823001D, 0.00085236463067489305D, 0.00087803107631781604D, 0.00090405637773081199D, 0.00092531628457959798D,
            0.00094461721992347301D, 0.00096040614145063497D, 0.00097475911168395804D, 0.00098556811727289D, 0.00099484499178925309D, 0.0010006553053761599D, 0.0010050290498218599D, 0.00100617210221234D, 0.00100598820112366D, 0.0010026867073676599D,
            0.00099804534329050792D, 0.00099037312341015006D, 0.0009814685575474599D, 0.00096969741145219897D, 0.00095643797019856003D, 0.00094071589759869205D, 0.0240815539286682D
    };
    private static final double[] FILT_COEFF_LPF = {
            -0.00016866785688004801D, -0.00032949186618124501D, -0.00057006323293083596D, -0.00082661223615165195D, -0.0010211855682086899D, -0.0010497117457102601D, -0.00080187259434079503D, -0.00019041491260798199D, 0.00081595195659634498D, 0.0021643648490299499D,
            0.0037051167998108899D, 0.0052017715760723704D, 0.0063672189918733899D, 0.0069221708621905204D, 0.0066650422908691703D, 0.0055357051397000199D, 0.0036561554436569002D, 0.0013304528984966501D, -0.00100139139502655D, -0.0028523185931574602D,
            -0.0038022287158875601D, -0.0036104946206457402D, -0.0022967987880685402D, -0.000163357055355674D, 0.00225439311612249D, 0.0043051218446998598D, 0.0053830238776528799D, 0.0050948619038305998D, 0.0033873161382916499D, 0.00059529517224541197D,
            -0.00261147051358666D, -0.0053796918092040898D, -0.0068910249216320102D, -0.0065940094969425102D, -0.0043866673630067899D, -0.00069322820676907999D, 0.0035980779193214001D, 0.0073337416847010402D, 0.0093900509737724399D, 0.0089923429122974203D,
            0.0059723202000867802D, 0.00088468697342035797D, -0.0050648415846142499D, -0.010281395995134701D, -0.013181619077912101D, -0.0126385734098676D, -0.00835374322437216D, -0.0010463658426189001D, 0.00761264761084114D, 0.0153341832929977D,
            0.0197543126832424D, 0.019069138209252601D, 0.012606419825639301D, 0.0011805929005384999D, -0.012882525912061699D, -0.026092227826642202D, -0.034463470304501101D, -0.034380896321908903D, -0.023468780690948099D, -0.00126440351872214D,
            0.0304747159292722D, 0.0679240217134153D, 0.105798489688712D, 0.138301661077912D, 0.16022441085564901D, 0.167961155238185D, 0.16022441085564901D, 0.138301661077912D, 0.105798489688712D, 0.0679240217134153D,
            0.0304747159292722D, -0.00126440351872214D, -0.023468780690948099D, -0.034380896321908903D, -0.034463470304501101D, -0.026092227826642202D, -0.012882525912061699D, 0.0011805929005384999D, 0.012606419825639301D, 0.019069138209252601D,
            0.0197543126832424D, 0.0153341832929977D, 0.00761264761084114D, -0.0010463658426189001D, -0.00835374322437216D, -0.0126385734098676D, -0.013181619077912101D, -0.010281395995134701D, -0.0050648415846142499D, 0.00088468697342035797D,
            0.0059723202000867802D, 0.0089923429122974203D, 0.0093900509737724399D, 0.0073337416847010402D, 0.0035980779193214001D, -0.00069322820676907999D, -0.0043866673630067899D, -0.0065940094969425102D, -0.0068910249216320102D, -0.0053796918092040898D,
            -0.00261147051358666D, 0.00059529517224541197D, 0.0033873161382916499D, 0.0050948619038305998D, 0.0053830238776528799D, 0.0043051218446998598D, 0.00225439311612249D, -0.000163357055355674D, -0.0022967987880685402D, -0.0036104946206457402D,
            -0.0038022287158875601D, -0.0028523185931574602D, -0.00100139139502655D, 0.0013304528984966501D, 0.0036561554436569002D, 0.0055357051397000199D, 0.0066650422908691703D, 0.0069221708621905204D, 0.0063672189918733899D, 0.0052017715760723704D,
            0.0037051167998108899D, 0.0021643648490299499D, 0.00081595195659634498D, -0.00019041491260798199D, -0.00080187259434079503D, -0.0010497117457102601D, -0.0010211855682086899D, -0.00082661223615165195D, -0.00057006323293083596D, -0.00032949186618124501D,
            -0.00016866785688004801D
    };

    public RawDataArrayX() {
    }

    public float applyFilterHPF(float[] array) {
        float f = 0f;
        for (int i = 0; i < array.length; i++) {
            f = (float) ((double) f + (double) array[i] * FILT_COEFF_HPF[i]);
        }
        return f;
    }

    public float applyFilterLPF(float[] array) {
        float f = 0f;
        for (int i = 0; i < array.length; i++) {
            f = (float) ((double) f + (double) array[i] * FILT_COEFF_LPF[i]);
        }
        return f;
    }

    public static int rawData;
    private static int bufferCounter = 0;

    public void filter(float[] array, float[] out, int n) {
        float[] a = new float[arrayLength + BUFFER_SIZE_LPF];
        for (int i = 0; i < arrayLength; i++) {
            a[n + i - 1] = array[i];
        }
        for (int i = 0; i < arrayLength; i++) {
            double sum = 0;
            for (int j = 0; j < n; j++) {
                sum += FILT_COEFF_LPF[j] * a[i - j + n - 1];
            }
            out[i] = (float) sum;
        }
        for (int i = 0; i < n - 1; i++) {
            a[n - i - 2] = array[arrayLength - 1 - i];
        }
    }
}
